---
title: "ML assigment 2"
author: "ISHIKA NISHA"
date: "10/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
library(readr)
library(dplyr)
library(fastDummies)
library(caret)
library(class)
```
getwd()

```{r}
Universal_bank<- read_csv("UniversalBank (5).csv")
print(Universal_bank)
```

#removing ID and ZipCode Columns from Dataset 
'''
Universal_bank <- Universal_bank[,c(-1,-5)]
str(Universal_bank)
'''
#As personal loan is predictive variable so converting it to factor
Universal_bank$`Personal Loan` <-as.factor(Universal_bank$`Personal Loan`)
Universal_bank$Education <-as.factor(Universal_bank$Education)
View(Universal_bank)
#Dummying

Universal_bank_d <- dummy_cols(Universal_bank %>% select(-`Personal Loan`))
Universal_bank_d <- Universal_bank_d %>% select(-Education) %>% 
  mutate(`Personal Loan` = Universal_bank$`Personal Loan`)
```

##Data Partition and preprocessing
```{r}
set.seed(200)
index <- createDataPartition( Universal_bank_d$`Personal Loan`, p=0.6, list = FALSE)
Universal_bank_train_df <- Universal_bank_d[index,]
Universal_bank_test_df <- Universal_bank_d[-index,]
'''
#normalize the data.
scale_fun <- preProcess(Universal_bank_train_df[,-14], method = c("center", "scale"))
Universal_bank_train_norm <- predict(scale_fun, Universal_bank_train_df[,-14])
Universal_bank_test_norm <- predict(scale_fun, Universal_bank_test_df[,-14])
dim(Universal_bank_train_norm)
summary(Universal_bank_train_norm)
summary(Universal_bank_test_norm)
```

##KNN Modeling
#1. Predicting the Customer with K=1
```{r}
#Predicting the Customer with K=1
Q1 <- data.frame(40, 10, 84, 2, 2, 0, 0, 0, 1, 1, 0, 1, 0)
knn_01<- knn(Universal_bank_train_norm, Q1, cl=Universal_bank_train_df$`Personal Loan`, k=1, prob = 0.5)
knn_01
```

#2.	Choice of k
```{r}
accuracy.df <- data.frame(k = seq(1, 14, 1), accuracy = rep(0, 14))
for(i in 1:14) {
  knn <- knn(Universal_bank_train_norm, Universal_bank_test_norm, cl = Universal_bank_train_df$`Personal Loan`, k = i)
  accuracy.df[i, 2] <- confusionMatrix(knn, Universal_bank_test_df$`Personal Loan`)$overall[1] 
}
accuracy.df
which.max( (accuracy.df$accuracy) ) #Here, our optimal k is 3
```

#3.	Validation data using the best k.
```{r}
knn_best <- knn(Universal_bank_train_norm,Universal_bank_test_norm,cl=Universal_bank_train_df$`Personal Loan`,k=3,prob = TRUE)
confusionMatrix(knn_best,Universal_bank_test_df$`Personal Loan`)
```

4.	Classify the customer using the best k
```{r}
knn_best1 <- knn(Universal_bank_train_norm, Q1, cl=Universal_bank_train_df$`Personal Loan`, k=3, prob = TRUE)
knn_best1
```
#5.	Repartition the data, this time into training, validation, and test sets (50% : 30% : 20%)
```{r}
set.seed(400)
index_b <- createDataPartition(Universal_bank_d$`Personal Loan`, p=0.5, list = FALSE)
Universal_bank_train_df2 <- Universal_bank_d[index_b,]
val_test_idx <- Universal_bank_d[-index_b,]
val_test_idx_b <- createDataPartition(val_test_idx$`Personal Loan`, p=0.6, list = FALSE)
Universal_bank_val_df2 <- val_test_idx[val_test_idx_b,]
Universal_bank_test_df2 <- val_test_idx[-val_test_idx_b,]

#normalize the data.
scale_fun_b <- preProcess(Universal_bank_train_df2[,-14], method = c("center", "scale"))
Universal_bank_train_norm2 <- predict(scale_fun_b, Universal_bank_train_df2[,-14])
Universal_bank_val_norm2 <- predict(scale_fun_b, Universal_bank_val_df2[,-14])
Universal_bank__test_norm2 <- predict(scale_fun_b, Universal_bank_test_df2[,-14])
knn.pred5 <- knn(Universal_bank_train_norm2, Universal_bank_val_norm2 , cl=Universal_bank_train_df2$`Personal Loan`, k=3, prob = TRUE)
confusionMatrix(knn.pred5,Universal_bank_val_df2$`Personal Loan`)
```



